---
## Author
author:
  name: Сардаров Тимур Алишерович
  group: НПИбд-02-25
  email: timursardarov475@gmail.com
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Отчет по лабораторной работе №5"
subtitle: "Архитектура компьютера"
license: "CC BY"

---

# Цель работы

Приобретение практических навыков работы в Midnight Commander. Освоение инструкций языка ассемблера mov и int.

# Выполнение лабораторной работы

1. Откройте Midnight Commander
user@dk4n31:~$ mc

![Шаг 1](image/1.png){#fig-001 width=90%}

2. Пользуясь клавишами ↑ , ↓ и Enter перейдите в каталог ~/work/arch-pc созданный
при выполнении лабораторной работы №4.

![Шаг 2](image/2.png){#fig-002 width=90%}

3. С помощью функциональной клавиши F7 создайте папку lab05 и перейдите
в созданный каталог.

![Шаг 3](image/3.png){#fig-003 width=90%}

4. Пользуясь строкой ввода и командой touch создайте файл lab5-1.asm.

![Шаг 4](image/4.png){#fig-004 width=90%}

5. С помощью функциональной клавиши F4 откройте файл lab5-1.asm для редактирова-
ния во встроенном редакторе. Как правило в качестве встроенного редактора Midnight
Commander используется редакторы nano или mcedit.

6. Введите текст программы из листинга 5.1 (можно без комментариев), сохраните изме-
нения и закройте файл.


Листинг 5.1. Программа вывода сообщения на экран и ввода строки с клавиатуры

```asm
;------------------------------------------------------------------
; Программа вывода сообщения на экран и ввода строки с клавиатуры
;------------------------------------------------------------------
;------------------- Объявление переменных ----------------
SECTION .data ; Секция инициированных данных
msg: DB 'Введите строку:',10 ; сообщение плюс
; символ перевода строки
msgLen: EQU $-msg ; Длина переменной 'msg'
SECTION .bss ; Секция не инициированных данных
buf1: RESB 80 ; Буфер размером 80 байт
;------------------- Текст программы -----------------
SECTION .text ; Код программы
GLOBAL _start ; Начало программы
_start: ; Точка входа в программу
;------------ Cистемный вызов `write`
; После вызова инструкции 'int 80h' на экран будет
; выведено сообщение из переменной 'msg' длиной 'msgLen'
mov eax,4 ; Системный вызов для записи (sys_write)
mov ebx,1 ; Описатель файла 1 - стандартный вывод
mov ecx,msg ; Адрес строки 'msg' в 'ecx'
mov edx,msgLen ; Размер строки 'msg' в 'edx'
int 80h ; Вызов ядра
;------------ системный вызов `read` ----------------------
; После вызова инструкции 'int 80h' программа будет ожидать ввода
; строки, которая будет записана в переменную 'buf1' размером 80 байт
mov eax, 3 ; Системный вызов для чтения (sys_read)
mov ebx, 0 ; Дескриптор файла 0 - стандартный ввод
mov ecx, buf1 ; Адрес буфера под вводимую строку
mov edx, 80 ; Длина вводимой строки
int 80h ; Вызов ядра
;------------ Системный вызов `exit` ----------------------
; После вызова инструкции 'int 80h' программа завершит работу
mov eax,1 ; Системный вызов для выхода (sys_exit)
mov ebx,0 ; Выход с кодом возврата 0 (без ошибок)
int 80h ; Вызов ядра
```



![Шаг 5-6](image/56.png){#fig-056 width=90%}

7. С помощью функциональной клавиши F3 откройте файл lab5-1.asm для просмотра.
Убедитесь, что файл содержит текст программы.

![Шаг 7](image/7.png){#fig-007 width=90%}

8. Оттранслируйте текст программы lab5-1.asm в объектный файл. Выполните компо-
новку объектного файла и запустите получившийся исполняемый файл. Программа выводит строку 'Введите строку:' и ожидает ввода с клавиатуры. На запрос введите
Ваши ФИО.

```bash
user@dk4n31:~$ nasm -f elf lab5-1.asm
user@dk4n31:~$ ld -m elf_i386 -o lab5-1 lab5-1.o
user@dk4n31:~$ ./lab5-1
Введите строку:
Имя пользователя
user@dk4n31:~$
```

![Шаг 8](image/8.png){#fig-008 width=90%}

## Подключение внешнего файла in_out.asm

Для упрощения написания программ часто встречающиеся одинаковые участки кода
(такие как, например, вывод строки на экран или выход их программы) можно оформить
в виде подпрограмм и сохранить в отдельные файлы, а во всех нужных местах поставить
вызов нужной подпрограммы. Это позволяет сделать основную программу более удобной
для написания и чтения.
NASM позволяет подключать внешние файлы с помощью директивы %include, которая
предписывает ассемблеру заменить эту директиву содержимым файла. Подключаемые фай-
лы также написаны на языке ассемблера. Важно отметить, что директива %include в тексте
программы должна стоять раньше, чем встречаются вызовы подпрограмм из подключае-
мого файла. Для вызова подпрограммы из внешнего файла используется инструкция call,
которая имеет следующий вид

```bash
call <function>
```

где function имя подпрограммы.
Для выполнения лабораторных работ используется файл in_out.asm1, который содержит
следующие подпрограммы [4]:
• slen – вычисление длины строки (используется в подпрограммах печати сообщения
для определения количества выводимых байтов);
• sprint – вывод сообщения на экран, перед вызовом sprint в регистр eax необходимо
записать выводимое сообщение (mov eax,<message>);
• sprintLF – работает аналогично sprint, но при выводе на экран добавляет к сообще-
нию символ перевода строки;
• sread – ввод сообщения с клавиатуры, перед вызовом sread в регистр eax необходи-
мо записать адрес переменной в которую введенное сообщение буд записано (mov
eax,<buffer>) , в регистр ebx – длину вводимой строки (mov ebx,<N>);
• iprint – вывод на экран чисел в формате ASCII, перед вызовом iprint в регистр eax
необходимо записать выводимое число (mov eax,<int>);
• iprintLF – работает аналогично iprint, но при выводе на экран после числа добавляет
к символ перевода строки;
• atoi – функция преобразует ascii-код символа в целое число и записыает результат
в регистр eax, перед вызовом atoi в регистр eax необходимо записать число (mov
eax,<int>);
• quit – завершение программы.
9. Скачайте файл in_out.asm со страницы курса в ТУИС.

10. Подключаемый файл in_out.asm должен лежать в том же каталоге, что и файл с про-
граммой, в которой он используется.
В одной из панелей mc откройте каталог с файлом lab5-1.asm. В другой панели каталог
со скаченным файлом in_out.asm (для перемещения между панелями используйте Tab ).
Скопируйте файл in_out.asm в каталог с файлом lab5-1.asm с помощью функциональной
клавиши F5 

![Шаг 10](image/10.png){#fig-010 width=90%}

11. С помощью функциональной клавиши F6 создайте копию файла lab5-1.asm с именем
lab5-2.asm. Выделите файл lab5-1.asm, нажмите клавишу F6 , введите имя файла
lab5-2.asm и нажмите клавишу Enter 

![Шаг 11](image/11.png){#fig-011 width=90%}

12. Исправьте текст программы в файле lab5-2.asm с использование подпрограмм из
внешнего файла in_out.asm (используйте подпрограммы sprintLF, sread и quit) в
соответствии с листингом 5.2. Создайте исполняемый файл и проверьте его работу.

Листинг 5.2. Программа вывода сообщения на экран и ввода строки с клавиатуры c
использованием файла in_out.asm

```asm
;--------------------------------------------------------------------
; Программа вывода сообщения на экран и ввода строки с клавиатуры
;---------------------------------------------------------------------
%include 'in_out.asm' ; подключение внешнего файла
SECTION .data ; Секция инициированных данных
msg: DB 'Введите строку: ',0h ; сообщение
SECTION .bss ; Секция не инициированных данных
buf1: RESB 80 ; Буфер размером 80 байт
SECTION .text ; Код программы
GLOBAL _start ; Начало программы
_start: ; Точка входа в программу
mov eax, msg ; запись адреса выводимого сообщения в `EAX`
call sprintLF ; вызов подпрограммы печати сообщения
mov ecx, buf1 ; запись адреса переменной в `EAX`
mov edx, 80 ; запись длины вводимого сообщения в `EBX`
call sread ; вызов подпрограммы ввода сообщения
call quit ; вызов подпрограммы завершения
```

13. В файле lab5-2.asm замените подпрограмму sprintLF на sprint. Создайте исполняе-
мый файл и проверьте его работу. В чем разница?

**Разница между sprintLF и sprint:**
- `sprintLF` выводит сообщение и добавляет перевод строки
- `sprint` выводит сообщение без перевода строки


![Шаг 13](image/13.png){#fig-013 width=90%}

# Задание для самостоятельной работы

1. Создайте копию файла lab5-1.asm. Внесите изменения в программу (без использова-
ния внешнего файла in_out.asm), так чтобы она работала по следующему алгоритму:
• вывести приглашение типа “Введите строку:”;
• ввести строку с клавиатуры;
• вывести введённую строку на экран.

```asm
;------------------------------------------------------------------
; Программа вывода сообщения на экран и ввода строки с клавиатуры
;------------------------------------------------------------------
SECTION .data
msg: DB 'Введите строку:',10
msgLen: EQU $-msg
SECTION .bss
buf1: RESB 80
SECTION .text
GLOBAL _start
_start:
; Вывод приглашения
mov eax,4
mov ebx,1
mov ecx,msg
mov edx,msgLen
int 80h
; Ввод строки
mov eax, 3
mov ebx, 0
mov ecx, buf1
mov edx, 80
int 80h
; ВЫВОД ВВЕДЕННОЙ СТРОКИ (НОВОЕ!)
mov eax,4
mov ebx,1
mov ecx,buf1
mov edx,80
int 80h
; Завершение программы
mov eax,1
mov ebx,0
int 80h
```

![Шаг 1](image/21.png){#fig-021 width=90%}

2. Получите исполняемый файл и проверьте его работу. На приглашение ввести строку
введите свою фамилию.

![Шаг 2](image/22.png){#fig-022 width=90%}

3. Создайте копию файла lab5-2.asm. Исправьте текст программы с использование под-
программ из внешнего файла in_out.asm, так чтобы она работала по следующему
алгоритму:
• вывести приглашение типа “Введите строку:”;
• ввести строку с клавиатуры;
• вывести введённую строку на экран.

```asm
;--------------------------------------------------------------------
; Программа вывода сообщения на экран и ввода строки с клавиатуры
;---------------------------------------------------------------------
%include 'in_out.asm'
SECTION .data
msg: DB 'Введите строку: ',0h
SECTION .bss
buf1: RESB 80
SECTION .text
GLOBAL _start
_start:
mov eax, msg
call sprintLF    ; Вывод приглашения
mov ecx, buf1
mov edx, 80
call sread       ; Ввод строки
; ВЫВОД ВВЕДЕННОЙ СТРОКИ (НОВОЕ!)
mov eax, buf1
call sprintLF    ; Вывод введенной строки
call quit
```

![Шаг 3](image/23.png){#fig-023 width=90%}

Не забудьте, подключаемый файл in_out.asm должен лежать в том же каталоге, что и
файл с программой, в которой он используется.

4. Создайте исполняемый файл и проверьте его работу.

![Шаг 4](image/24.png){#fig-024 width=90%}



# Выводы

Проделанную работу можно найти по ссылке: https://github.com/tasardarov/study_2025-2026_arh-pc.git

Мы приобрели практические навыки работы в Midnight Commander. Освоили инструкции языка ассемблера mov и int.

# Список литературы{.unnumbered}

::: {#refs}
1. GDB: The GNU Project Debugger. — URL: https://www.gnu.org/software/gdb/.
2. GNU Bash Manual. — 2016. — URL: https://www.gnu.org/software/bash/manual/.
3. Midnight Commander Development Center. — 2021. — URL: https://midnight-commander.
org/.
4. NASM Assembly Language Tutorials. — 2021. — URL: https://asmtutor.com/.
5. Newham C. Learning the bash Shell: Unix Shell Programming. — O’Reilly Media, 2005. —
354 с. — (In a Nutshell). — ISBN 0596009658. — URL: http://www.amazon.com/Learning-
bash-Shell-Programming-Nutshell/dp/0596009658.
6. Robbins A. Bash Pocket Reference. — O’Reilly Media, 2016. — 156 с. — ISBN 978-1491941591.
7. The NASM documentation. — 2021. — URL: https://www.nasm.us/docs.php.
8. Zarrelli G. Mastering Bash. — Packt Publishing, 2017. — 502 с. — ISBN 9781784396879.
9. Колдаев В. Д., Лупин С. А. Архитектура ЭВМ. — М. : Форум, 2018.
10. Куляс О. Л., Никитин К. А. Курс программирования на ASSEMBLER. — М. : Солон-Пресс,
2017.
11. Новожилов О. П. Архитектура ЭВМ и систем. — М. : Юрайт, 2016.
12. Расширенный ассемблер: NASM. — 2021. — URL: https://www.opennet.ru/docs/RUS/nasm/.
13. Робачевский А., Немнюгин С., Стесик О. Операционная система UNIX. — 2-е изд. — БХВ-
Петербург, 2010. — 656 с. — ISBN 978-5-94157-538-1.
14. Столяров А. Программирование на языке ассемблера NASM для ОС Unix. — 2-е изд. —
М. : МАКС Пресс, 2011. — URL: http://www.stolyarov.info/books/asm_unix.
15. Таненбаум Э. Архитектура компьютера. — 6-е изд. — СПб. : Питер, 2013. — 874 с. —
(Классика Computer Science).
16. Таненбаум Э., Бос Х. Современные операционные системы. — 4-е изд. — СПб. : Питер,
2015. — 1120 с. — (Классика Computer Science).
:::
